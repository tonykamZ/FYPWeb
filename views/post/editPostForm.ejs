<head>
    <title>Edit post</title>
    <style>
        .container {
            padding-top: 10px;
        }

        .fa-plus {
            float: right;
        }

        .fa-minus {
            float: right;
        }

        #minusInput {
            display: none;
        }

        .btn:focus {
            outline: none;
            box-shadow: none;
        }
    </style>

</head>

<body>

    <% if(!post){ %>
        <h1>No result!</h1><small>Please make sure the id field in the path is correct!</small>
        <small>Manually change the id field may cause this error.</small>
        <% }else{ %>
            <div class="container">
                <h3 class="text-custom-create"><b>Edit the post</b></h3>
                <form method="POST" action="/manage/post/<%= post._id %>">
                    <div class="form-row">
                        <div class="form-group col-md-4">
                            <label><b>Post Title</b></label>
                            <input type="string" value="<%= post.post.title %>" class="form-control" name="title"
                                required>
                        </div>

                    </div>

                    <div class="form-row">
                        <div class="form-group col-md-4">
                            <label><b>Description</b></label>
                            <textarea rows="5" id="description" name="description" class="form-control"
                                required><%= post.post.description %></textarea>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group col-md-2">
                            <label><b>Member limit</b></label>
                            <input value="<%= post.post.memberLimit %>" type="number" class="form-control"
                                name="memberLimit" min=2 max=100 readonly>
                        </div>

                        <div class="form-group col-md-4">
                            <label><b>Attribution</b></label>
                            <button id="addInput" class="btn btn-info tooltip-top"
                                data-tooltip="Add additional attribution" type="button" onclick="AddExtraInput()"><i
                                    class="fa fa-plus"></i></button>
                            <button id="minusInput" class="btn btn-danger tooltip-top"
                                data-tooltip="Reduce additional attribution"" type=" button"
                                onclick="MinusExtraInput()"><i class="fa fa-minus"></i></button>

                            <input value="<%= post.post.attribution %>" type="url" class="form-control"
                                name="attribution" required>

                            <input type="url" class="form-control" name="attribution2" id="attribution2" hidden>
                            <input type="url" class="form-control" name="attribution3" id="attribution3" hidden>
                            <input type="url" class="form-control" name="attribution4" id="attribution4" hidden>
                            <input type="url" class="form-control" name="attribution5" id="attribution5" hidden>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group col-md-4">
                            <label><b>Upload Image URL</b></label>
                            <input value="<%= post.post.imgInput %>" type="url" class="form-control" name="imgInput"
                                id="imgInput" required>
                        </div>

                    </div>
                    <p><small>don't know how to convert the image to url? refer to this website: <a
                                href="https://www.linkpicture.com/" target="_blank"
                                style="color: blue;">https://www.linkpicture.com/</a></small></p>
                    <br>
                    <div>
                        <% if(req.session.memberid){ %>
                            <% if(post.HostUsername==req.session.memberid){ %>
                                <button class="btn btn-outline-success" type="submit">Confirm the changes</button>
                                <button class="btn btn-outline-secondary" type="button"
                                    onclick="window.history.back()">Cancel</button>
                                <% }else{ %>
                                    <h3>You are not the host of this post. You do not have right to edit!</h3>
                                    <button class="btn btn-outline-secondary" type="button"
                                    onclick="window.history.back()">Back</button>
                                    <% } %>


                                        <% }else{ %>
                                            <h3>Are you the host of this post?</h3>
                                            <a class="btn btn-primary" href="/login">Login</a> to edit
                                            this post.
                                            <% } %>
                    </div>

                    <br>
                    <small>
                        <b>**IMPORTANT**</b> Please make sure the information that you provided is correct. Suspicious
                        malicious
                        behavior may cause
                        credit score deduction of your account. Low credit score may lead to account restriction. For
                        details,
                        please check out our <a href="/terms" style="color: blue;">policies and terms.</a>
                    </small>

                </form>

                <br><br><br>
            </div>
            <% } %>
</body>

<script>
    var inputOffset = 1;
    function AddExtraInput() {

        if (inputOffset == 1) {
            var attr2 = document.getElementById("attribution2");
            attr2.hidden = false;
            attr2.required = true;
            inputOffset++;
            document.getElementById("minusInput").style.display = "inline";
        } else if (inputOffset == 2) {
            var attr3 = document.getElementById("attribution3");
            attr3.hidden = false;
            attr3.required = true;
            inputOffset++;
        } else if (inputOffset == 3) {
            var attr4 = document.getElementById("attribution4");
            attr4.hidden = false;
            attr4.required = true;
            inputOffset++;
        } else if (inputOffset == 4) {
            var attr5 = document.getElementById("attribution5");
            attr5.hidden = false;
            attr5.required = true;
            inputOffset++;
            // input offset > input fields (5)
            // hide the add button
            document.getElementById("addInput").style.display = "none";
        }

    }

    function MinusExtraInput() {
        if (inputOffset == 2) {
            document.getElementById("minusInput").style.display = "none";
            var attr2 = document.getElementById("attribution2");
            attr2.hidden = true;
            attr2.required = false;
            inputOffset--;
        } else if (inputOffset == 3) {
            var attr3 = document.getElementById("attribution3");
            attr3.hidden = true;
            attr3.required = false;
            inputOffset--;
        } else if (inputOffset == 4) {
            var attr4 = document.getElementById("attribution4");
            attr4.hidden = true;
            attr4.required = false;
            inputOffset--;
        } else if (inputOffset == 5) {
            var attr5 = document.getElementById("attribution5");
            attr5.hidden = true;
            attr5.required = false;
            inputOffset--;
            document.getElementById("addInput").style.display = "inline";
        }
    }

    function ShowFileName() {
        var imgInput = document.getElementById("imgInput");
        var filenameDisplay = document.getElementById("filenameDisplay");

        filenameDisplay.innerHTML = "";
        filenameDisplay.innerHTML += "Selected: " + imgInput.files[0].name;
    }
</script>